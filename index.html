<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <title>Chat</title>
</head>
<body>

    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    
 
    <main>
        <div class="authorization">
            <div  class="row">
               
                <button id="google" type="button" class="btn btn-secondary col-4 col-sm-3 col-md-4">Google</button>
                <button id="facebook" type="button" class="btn btn-secondary col-4 col-sm-3 col-md-4">facebook</button>
            </div>
        </div>

        <div id="dashboard" class="">
            <div id="divMessages" class="message border rounded container">
 
            </div>
            <div class="container">
                <div id="blockSendMessage" class="row">
                
                    <button id="sis" type="button" class="btn btn-secondary col-4 col-sm-3 col-md-4">Sis!</button>
                    <button id="bro" type="button" class="btn btn-secondary col-4 col-sm-3 col-md-4">Bro!</button>
                </div>
            </div>

            <button id="logout" type="button" class="btn btn-secondary ">Logout</button>
        </div>  

        <div id="counterSis" class="message border rounded container">
 
        </div>

        <div id="counterBro" class="message border rounded container">
 
        </div>
        
    </main>

    <script  src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>
    <script  src="https://www.gstatic.com/firebasejs/7.13.2/firebase-auth.js"></script>
    <script  src="https://www.gstatic.com/firebasejs/7.13.2/firebase-firestore.js"></script>
    <script  src="https://www.gstatic.com/firebasejs/7.13.2/firebase-storage.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>
    <script src="au.js"></script>
    
    <script>

const firebaseConfig = {
    apiKey: "AIzaSyDGVBIMebjzCHTkX1HIgY8tpj_kl2E8Kk4",
    authDomain: "chat-app-61327.firebaseapp.com",
    databaseURL: "https://chat-app-61327-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "chat-app-61327",
    storageBucket: "chat-app-61327.appspot.com",
    messagingSenderId: "1077563769226",
    appId: "1:1077563769226:web:c0beb389627539f73d4873"
  };
  // Initialize Firebase
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

console.log("Firebase connected");


        
        // Получаем элемент чата
let chat = document.querySelector("#divMessages")

// Получаем кнопку для ввода сообщения
let button = document.querySelectorAll("button");
let btnSis = document.querySelector("#sis")
let btnBro = document.querySelector("#bro")
let counterSis = document.querySelector("#counterSis")
let counterBro = document.querySelector("#counterBro")


console.log( "+++ " + button);
console.log( "--- " + btnSis.innerText);
console.log( "--- " + btnBro.innerText);
 

function sendMessage(object){
    console.log(object)
    db.collection("button").add(object).then(added => {
        console.log("message sent ",added)
    }).catch(err => {
        console.err("Error occured",err)
    })

}
 
let countSis = 0;
let countBro = 0;

db.collection("button").orderBy("date").onSnapshot(function(snapshot){
    snapshot.docChanges().forEach(function(change,ind){
        let data = change.doc.data();
            if (data.message ==  "Sis!") {
                countSis += 1;
            }
            if (data.message ==  "Bro!") {
                countBro += 1;
            }

            
            //console.log("*****" + data.message);
            //console.log("---sis--" + countSis + "---bro--" + countBro);
            //console.log("++++ " + Object.keys(data));
            // if new message added
            
            chat.textContent =  data.message + " at " + data.date;
            counterSis.textContent =  "Sis: " + countSis;
            counterBro.textContent =  "Bro: " + countBro;

    })
})

 
// Отслеживаем нажатие мыши
btnSis.addEventListener("click", () => {
    // Получаем текст из формы для ввода сообщения
    message = btnSis.innerText;
    // Отправка сообщения через WS
    sendMessage({
            message : message,
            date : moment().format("HH:mm:ss")
        })
    console.log("send " + message);
    
})
btnBro.addEventListener("click", () => {
    // Получаем текст из формы для ввода сообщения
    message = btnBro.innerText;
    // Отправка сообщения через WS
    sendMessage({
            message : message,
            date : moment().format("HH:mm:ss")
        })
    console.log("send " + message);
    
})
    </script>
    
</body>
</html>